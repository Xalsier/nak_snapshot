const getFirstDayOfMonth=(e,t)=>new Date(e,t,1).getDay(),isPastDate=(e,t,n)=>new Date(e,t,n)<new Date,isToday=(e,t,n)=>new Date(e,t,n).toDateString()===new Date().toDateString(),initialDate=new Date;let eventImageContainer;showEventImage=(e,t)=>{(async()=>{async function n(e){try{let t=new Image;return t.src=e,await t.decode(),eventImageContainer.innerHTML="",eventImageContainer.appendChild(t),!0}catch(n){return!1}}for(let a of(eventImageContainer||((eventImageContainer=document.createElement("div")).className="event-image-container",document.body.appendChild(eventImageContainer)),e))if(await n(a.src))break;eventImageContainer.style.left=`${t.right}px`,eventImageContainer.style.top=`${t.top}px`})()},hideEventImage=()=>eventImageContainer&&(eventImageContainer.innerHTML=""),createCalendar=(e,t,n,a)=>{let i=document.createElement("div");i.className="calendar-container",["日","月","火","水","木","金","土"].forEach(e=>{let t=document.createElement("div");t.className="calendar-weekday",t.textContent=e,i.appendChild(t)});let r=getFirstDayOfMonth(n,a),l=Object.keys(e);for(let s=0;s<r;s++){let d=document.createElement("div");d.className="calendar-day empty",i.appendChild(d)}for(let o=1;o<=t;o++){let c=document.createElement("div");c.className="calendar-day",c.setAttribute("data-day",o),c.innerHTML=`${o}`,isToday(n,a,o)&&c.classList.add("today","vibrate"),isPastDate(n,a,o)&&c.classList.add("past");let g=`${n}-${(a+1).toString().padStart(2,"0")}-${o.toString().padStart(2,"0")}`;if(l.includes(g)){let m=e[g];isPastDate(n,a,o)?c.classList.add(`past-event-${m.type}`):c.classList.add(`event-${m.type}`),m.images&&(c.addEventListener("mouseenter",()=>{showEventImage(m.images,c.getBoundingClientRect())}),c.addEventListener("mouseleave",hideEventImage))}i.appendChild(c)}return i},setCalendarMonthYear=(e,t)=>{let n=document.getElementById("calendar-month-year");n&&(n.innerHTML="",n.textContent=12*e+t+1)},updateCalendar=async e=>{let t=e.getFullYear(),n=e.getMonth(),a=new Date(t,n+1,0).getDate();setCalendarMonthYear(t,n);let i=await fetchEvents(),r=createCalendar(i,a,t,n),l=document.getElementById("calendar");l&&(l.innerHTML="",l.appendChild(r),updateEventColors(i,t,n))},findEvent=(e,t,n,a)=>e.find(e=>{let i=new Date(`${e.date}T00:00:00.000Z`),r=6e4*i.getTimezoneOffset(),l=new Date(i.getTime()+r);return l.getFullYear()===t&&l.getMonth()===n&&l.getDate()===a})||null,fetchEvents=async()=>{try{return(await (await fetch("eve.json")).json()).events}catch(e){return{}}},(async()=>{events=await fetchEvents(),updateCalendar(currentDate=new Date);let e=document.getElementById("previous-month");e&&e.addEventListener("click",()=>{currentDate.setMonth(currentDate.getMonth()-1),updateCalendar(currentDate)});let t=document.getElementById("next-month");t&&t.addEventListener("click",()=>{currentDate.setMonth(currentDate.getMonth()+1),updateCalendar(currentDate)})})();